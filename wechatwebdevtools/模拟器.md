# 模拟器
## 触发模拟器
1. 点击开发界面的 模拟器button，则出现模拟器区域，可以仿真显示代码编译后的执行效果
```
onSetSimulator() {
    this.props.toolbarConfigShow || (this.props.simulatorPopup ? (this.props.windowActions.toggleSimulatorWindow(),
    this.props.compile()) : this.props.windowActions.toggleSimulatorWindow())
}
```
2. dispatch了一个action，reducer中修改了store.simulator.show
```
{
    type: d.WINDOW_TOGGLE_SIMULATOR
}

case e.WINDOW_TOGGLE_SIMULATOR:
    {
        const a = {};
        return a.show = !h.simulator.show,
        'popup' === h.simulator.position && (a.show = !0,
        a.position = 'left'),
        _extends({}, h, {
            simulator: _extends({}, h.simulator, a)
        })
    }
```

## 模拟器组件
6620a0cf7dad1b400d60f0fdae40f524.js

```
b.createElement(k, {
    templateHTML: 'html/standalone.html',
    wrapperProps: e,
    title: la.config.SIMULATOR_WINDOW_TITLE.format(decodeURIComponent(c.project.projectname)),
    frame: !0,
    show: !1,
    width: c.deviceWidth,
    height: c.deviceHeight + 27,
    resizable: !1,
    fullscreen: !1,
    always_on_top: !1,
    onWindowClose: this.onSimulatorWindowClose.bind(this),
    onReady: this.onSimulatorWindowReady.bind(this),
    renderClass: d
})
```
1. 执行onReady: this.onSimulatorWindowReady.bind(this)
```
onSimulatorWindowReady() {
    'popup' === this.props.simulatorPosition && this.props.simulatorActions.compile()
}
```
  - MsgCenter(websocketServer)发送消息 {type:'COMMAND',data: a.origin, command:e}
  - dispatch了一个action，reducer中赋值了compileCommand：extends({}, e.data, {ts：Date.now()}}
2. 核心组件实现

584aae91d7c83393222029103ba1ac29.js

c347d628ff50158115a95a6e980c1738.js
```
<D> //容器组件，主要是样式
    <z/> //组件z，header部分，包括机型选择、区域大小、网络等
    <div className="simulator-shell">
        <div className="simulator">
            <H/>  // 模拟器的状态栏
            <M/>  // 绝对定位的空白页面
            <c/>  // js/d8460cd7eec9b5ac3077a1c3fc6a50d2.js 标题栏，包含右侧胶囊控件，其中：baseURL: `http://127.0.0.1:${global.proxyPort}/__pageframe__/`
            {this.getWebviewNodes()} // 组件e(js/48ed383395967d737f11ebc42820b913.js) 或组件f(js/41c99b908d0cb118c2a6fcf3c306663c.js)
            <d/>  // TabBar
            <g/>  // previewImage, 懒加载Image (weui-gallary)
            <j/>  // Toast，weui-toast
            <k/>  // ModelDialog, weui-dialog
            <l/>  // ActionSheet, weui-actionsheet
            <m/>  // RightBtnActionSheet
            {this.getOptionsComponents()} // q-SelectorPicker, n-datePicker, o-timePicker, p-multiPicker, h-payment, u-confirm, B-authorize
            <r/>  // share组件
            <Q/>  // Debugger组件，断点
            {this.getWindowComponents()} //s-group,t-setting,E-addCard, F-viewCard, N-h5AddCard, O-h5ViewCard, P-h5ChooseCard, C-location, J-addPhoneContact, K-chooseAddress, L-choseInvoiceTitle
        </div>
    </div>
    <v/>  // 底部组件，显示页面路径、场景值、页面参数
    <I/>  // 场景列表
    <div></div>
</D>
```

3. 组件e - webview (js/48ed383395967d737f11ebc42820b913.js)
src:`http://127.0.0.1:${global.proxyPort}/__pageframe__/pageframe.html`

    - js/0c4823143da6a69d89b64580be1021af.js
    - js/a78e6d6a87de1708226375ca4c320d76.js
    - js/015fdda1d1aad2fb64ce9f97d3c60553.js
    - js/0db6515f85d6f6210c2d50722041eb1f.js
4. 组件f - webview 以及对应的devtools (js/41c99b908d0cb118c2a6fcf3c306663c.js) 
    - js/c2a80787c66a9374529d46b5572ce35d.js
    
## 模拟器原理
1. 模拟器的实现，分header、simulator-shell、footer、场景列表。
2. 各个组件的实现
3. 加载资源并渲染
4. devtools


