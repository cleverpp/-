# 真机调试
## 触发真机调试
```
async remoteDebug(a) {
    if (a.stopPropagation(),
    !(this.props.actionBtnDisabled || this.props.toolbarConfigShow)) {
        const b = H.get(y.WINDOW_REGISTRY.REMOTE_DEBUG_WINDOW);
        if (b)
            return void b.focus();
        if (this.props.remoteDebugWindow.debuggingProjectId)
            return this.props.project.projectid === this.props.remoteDebugWindow.debuggingProjectId ? void 0 : void this.showErr(z.config.TOOLBAR_REMOTE_DEBUG_ERROR);
        this.props.windowActions.setRemoteDebugWindow({
            debuggingProjectId: this.props.project.projectid
        });
        const c = a.currentTarget.getBoundingClientRect();
        this.props.toolbarActions.toggleRemoteDebugCode({
            left: c.left,
            top: c.top
        }), 
        this.setState({
            timeStamp: 1 * new Date
        })
    }
}
```
1. this.props.toolbarActions.toggleRemoteDebugCode  触发显示真机调试二维码
  - js/fc137838572a83604db39acff8e909e0.js
    ```
    toggleRemoteDebugCode: function(a) {
      return {
          type: l.TOOLBAR_REMOTE_DEBUG_CODE,
          data: a
      }
    },

    ```
    - js/f81bd6d4e666827b025a83f7fc13cbce.js
    ```
    case d.TOOLBAR_REMOTE_DEBUG_CODE:
      return _extends({}, c, {
          clickKey: e.REMOTEDEBUGCODE
      });
    ```
    - js/629ccf62fc18c4d6caab59c1e6619a09.js
    详细见 扫描二维码预览或真机调试 章节

2. this.props.windowActions.setRemoteDebugWindow 

## 扫描二维码预览或真机调试
629ccf62fc18c4d6caab59c1e6619a09.js
1. 自定义预览前预处理
2. 获取有效端口
3. 上传代码 d(j) js/f0466135fc8b3a662084784e5f4ac792.js 详细见 上传代码 章节
    ```
    module.exports = async function(a) {
        return B.enqueueBuildTask(b.bind(null, a), B.buildType.upload)
    }
    ```
    上传代码成功后，获取了很多信息，例如：wxpkg_info、room_id、qrcode_img、username等。 其中qrcode_img用来渲染生成二维码
    
4. 初始化调试环境 l.init js/63f52c9055d92f52ca0510da7d3dcadb.js 详细见 初始化调试环境 章节
    ```
    let j = await l.init(g.project,{wxpkg_info:c,room_id:d,username:h,appid:g.project.appid},  
    { 
      usingLocalStorage:g.remoteDebugWindow.usingLocalStorage,
      remoteDebugLocal:global.l,
      clientProxyPort:i,
      onStatusUpdate:(b,c)=>{
           this.state.show && (c && j && j.url ?(this.props.windowActions.setRemoteDebugWindow({show:!0,inspectUrl:j.url,serverInfo:a}),
           this.setState({show:!1}),
           this.props.toggleClickKey(f.NONE)):this.setState({remoteDebugStatus:b}))},
      onProgressUpdate:b,
      onEvent:(a)=>{this.state.show&&this.setState({remoteDebugEvents:(this.state.remoteDebugEvents||[]).concat(a)})},
      isGame:'game'===g.project.compileType})
    ```
  - onStatusUpdate 更新状态信息设置远程调试窗口，或this.setState.remoteDebugStatus
    ```
      REMOTE_DEBUG_END: '已结束，请重新开始',
      REMOTE_DEBUG_NOT_UNINITIALIZED: '未初始化',
      REMOTE_DEBUG_NOT_CONNECTED: '未连接',
      REMOTE_DEBUG_LOGOUT: '已登出',
      REMOTE_DEBUG_LOGINING: '正在登陆',
      REMOTE_DEBUG_WAIT_SERVICE: '等待设备',
      REMOTE_DEBUG_SERVER_BLOCKING: '服务器阻塞',
      REMOTE_DEBUG_WAITING_FOR_RESPONSE: '等待回包',
      REMOTE_DEBUG_WORK_CORRECTLY: '正常',
      REMOTE_DEBUG_UNKNOWN: '未知',
    ```
  - onProgressUpdate  更新进度信息设置 this.state.progressDetailedText 和 this.state.stage
  - onEvent 设置 this.state.remoteDebugEvents

### 上传代码
f0466135fc8b3a662084784e5f4ac792.js

### 初始化调试环境
63f52c9055d92f52ca0510da7d3dcadb.js


